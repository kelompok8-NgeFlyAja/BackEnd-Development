// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

// Prisma schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Airports {
  id              Int @id @default(autoincrement())  
  name            String
  city            String
  country         String
  continent       String
  airportCode     String @unique

  departureRoutes Routes[] @relation("DepartureAirport")
  arrivalRoutes   Routes[] @relation("ArrivalAirport")
}

model Routes {
  id                  Int @id @default(autoincrement())  
  departureAirportId  Int    
  arrivalAirportId    Int    
  seatClassId         Int @unique

  departureAirport    Airports @relation("DepartureAirport", fields: [departureAirportId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  arrivalAirport      Airports @relation("ArrivalAirport", fields: [arrivalAirportId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  seatClass           SeatClasses @relation(fields: [seatClassId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  flights             Flights?
}

model Flights {
  id              Int     @id @default(autoincrement()) 
  routeId         Int     @unique
  planeId         Int     @unique
  promotionId     Int?    @unique
  duration        String
  departureTime   DateTime  @db.Timestamptz(3)
  arrivalTime     DateTime  @db.Timestamptz(3)
  flightCode      String

  route           Routes       @relation(fields: [routeId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  plane           Planes       @relation(fields: [planeId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  promotion       Promotions?  @relation(fields: [promotionId], references: [id], onUpdate: Cascade, onDelete: SetNull)

  bookings        Bookings[]   // Relasi dengan model Bookings
}

model Planes {
  id           Int   @id @default(autoincrement())  
  planeName    String
  totalSeat    Int
  planeCode    String
  description  String
  baggage      Int
  cabinBaggage Int

  flights Flights? // Relasi dengan model Flights
  seats   Seats[]   // Relasi dengan model Seats
}

model Seats {
  id          Int  @id @default(autoincrement())  
  planeId     Int
  seatNumber  String
  isAvailable Boolean

  plane       Planes  @relation(fields: [planeId], references: [id], onUpdate: Cascade, onDelete: Cascade)
}

model Users {
  id          Int  @id @default(autoincrement())  
  name        String
  email       String  @unique
  phoneNumber String
  password    String
  isActivated Boolean

  bookings    Bookings[] // Relasi dengan model Bookings
}

model Bookings {
  id          Int      @id @default(autoincrement())  
  userId      Int
  flightId    Int
  bookingCode String
  bookingDate DateTime
  status      BookingsStatus @default(PENDING)
  bookerName  String
  bookerEmail String
  bookerPhone String
  totalPrice  Int

  user        Users       @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  flight      Flights     @relation(fields: [flightId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  passengers  Passengers[] // Relasi dengan model Passengers
  payments    Payments?   // Relasi dengan model Payments
}

model Passengers {
  id              Int  @id @default(autoincrement())  
  bookingId       Int
  title           String
  fullName        String
  familyName      String
  birthDate       DateTime
  nationality     String
  identityNumber  String
  identityCountry String
  identityExpired DateTime

  booking         Bookings @relation(fields: [bookingId], references: [id], onUpdate: Cascade, onDelete: Cascade)
}

model Payments {
  id            Int  @id @default(autoincrement())  
  bookingId     Int  @unique
  paymentMethod String
  amount        Int
  expiredDate   DateTime
  status        PaymentsStatus @default(Unpaid)

  booking       Bookings @relation(fields: [bookingId], references: [id], onUpdate: Cascade, onDelete: Cascade)
}

model Promotions {
  id            Int  @id @default(autoincrement())  
  promotionName String
  image         String
  startDate     DateTime
  endDate       DateTime
  discount      Int

  flights       Flights? // Relasi dengan model Flights
}

model SeatClasses {
  id         Int   @id @default(autoincrement())  
  name       String
  priceAdult Int
  priceChild Int
  priceBaby  Int

  route     Routes? // Relasi dengan model Routes
}

enum BookingsStatus {
  PENDING
  SUCCESS
  CANCEL
}

enum PaymentsStatus {
  Unpaid
  Issued
  Cancelled
}